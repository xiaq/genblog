<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />
  {{ if is "homepage" }}
    <link rel="alternate" type="application/atom+xml"
          href="{{ .RootURL }}/feed.atom">
  {{ end }}

  <title>
    {{ if is "homepage" }}
      {{ .BlogTitle }}
    {{ else if is "category" }}
      {{ index .CategoryMap .Category }}
    {{ else }}
      {{ .Title }}
    {{ end }}
  </title>
  <style> {{ .CSS }} </style>
</head>
<body>
  <div class="card" id="header">
    <a href="{{ homepageURL }}" class="nav-link">{{ .BlogTitle }}</a>
  </div>
  {{/* The reference to the "content" template is a free one and has to be
  fixed elsewhere. For instance, by adding the following code this template
  will function as the template for articles:
      {{ define "content" }} {{ template "article-content" . }} {{ end }}
  Actually this is exactly what contentIs("article") will generate. */}}
  {{ template "content" . }}
</body>
</html>

{{ define "category-list" }}
  {{ $cat := .Category }}
  <ul class="category-list">
    {{ range $info := .Categories }}
      <li class="{{ if eq $cat $info.Name }}current{{ end }}">
        <a href="{{ categoryURL $info.Name }}" class="nav-link {{ if and (eq $cat $info.Name) (is "category") }} current {{ end }}">
          {{ $info.Title }}
        </a>
      </li>
    {{ end }}
  </ul>
{{ end }}

{{ define "homepage-content" }}
  {{ range .Articles }}
    {{ template "article-content" . }}
  {{ end }}
{{ end }}

{{ define "article-content" }}
  <div class="card-notes">
    {{ template "category-list" . }}
  </div>
  <div class="card noted">
    <article class="article">
      <h1>
        <a href="{{ articleURL .Category .Name }}"
           class="nav-link {{ if is "article" }} current {{ end }}">
          {{ .Title }}
        </a>
      </h1>
      <div class="clear"></div>
      <span class="article-meta header">
        {{ index .CategoryMap .Category }} · {{ .Timestamp }}</span>
      <div class="clear"></div>
      {{ .Content }}
      <div class="clear"></div>
    </article>
  </div>
{{ end }}

{{ define "category-content" }}
  <div class="card-notes">
    {{ template "category-list" . }}
  </div>
  <div class="card noted">
    <ul class="article-list">
      {{ $catMap := .CategoryMap }}
      {{ range $info := .Articles }}
        <li>
          <a href="{{ articleURL $info.Category $info.Name }}"
             class="nav-link">{{ $info.Title }}</a>
          <span class="article-meta">
          {{ if not (is "category") }}
            {{ index $catMap $info.Category }} ·
          {{ end }}
          {{ $info.Timestamp }}
          </span>
          <div class="clear"></div>
        </li>
      {{ end }}
    </ul>
  </div>
{{ end }}

<!-- vi: se sw=2 ts=2 sts=2 et: -->
